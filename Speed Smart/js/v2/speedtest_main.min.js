// Copyright 2018 Speedsmart.net
var URL_ping,URL_download,URL_upload,total_downloaded=0,total_uploaded=0,should_start=(starting=window.location.toString()).substring(starting.indexOf("/")+1);function getJSessionId(){var e=document.cookie.match(/PHPSESSID=[^;]+/);return null!=e&&(e=e instanceof Array?e[0].substring(10):e.substring(10)),e}var starting,parameters={url_dl:"https://tampa.veeapps.com/100MB.bin",url_ul:"https://tampa.veeapps.com/upload.php",url_ping:"https://tampa.veeapps.com/latency.txt"};should_start=(starting=window.location.toString()).substring(starting.indexOf("/")+1);function startup_data(){$.getJSON("https://speedsmart.net/resources/startupJSON.php",function(e){"/speedsmart.net/start"===should_start?setTimeout(function(){$("#start_button").trigger("click")},1500):($("#start_button").fadeTo(250,1),document.getElementById("start_button").disabled=!1),parameters.url_dl=e.closestServerPrimary,parameters.url_ul=e.closestServerUpload,parameters.url_ping=e.closestServerPing,$("#current_provider_name").html(e.user_isp),$("#provider_info").attr("href","https://speedsmart.net/provider/"+e.user_isp),$("#provider_info").attr("title",e.user_isp+" Speed Test"),$("#server_name").html(e.closestServerName),$("#server_name_change").html(e.closestServerName),$("#current_ip_address").html(e.user_address)}),$.getJSON("https://speedsmart.net/resources/serversJSON.php",function(e){for(var t=e.serverList.length-1;t>=0;t--){var s=e.serverList[t];$("#server_list").append('<div class="server"><div class="data" style="display:none">'+s.serverName+"::"+s.download_primary+"::"+s.upload_url+"::"+s.ping_url+"::"+s.download_small+"::"+s.download_secondary+'::</div> <div class="title">'+s.serverName+'</div><div class="distance">~'+s.distance+" away</div></div>")}$(".server").on("click",function(){var e=$(this).text(),t=e.split("::",1)[0],s=e.split("::",2)[1],r=(e.split("::",6)[5],e.split("::",5)[4]),n=e.split("::",3)[2],a=e.split("::",4)[3];$("#server_name").html(t),$("#server_name_change").html(t),/Android|webOS|iPhone|iPad|iPod|Opera Mini/i.test(navigator.userAgent)?(download_URL_Primary=r,uploadUrl=n,PING_URL=a):(parameters.url_dl=s,parameters.url_ul=n,parameters.url_ping=a,console.log(parameters)),toggle_hide("servers_list")})})}function I(e){return document.getElementById(e)}startup_data();var w=null;function startStop(){$("#down_speed").html("0.00"),$("#ping_score").html("0.00"),$("#change_server").fadeTo(250,0),$("#change_server").hide(),$("#view_start").fadeTo(250,0,function(){$("#view_start").hide(),document.getElementById("view_running").style.visibility="visible",$("#view_running").fadeTo(250,1)}),null!=w?(w.postMessage("abort"),w=null,I("startStopBtn").className="",initUI()):((w=new Worker("https://speedsmart.net/js/v2/speedtest_worker.min.js?41434233")).postMessage("start "+JSON.stringify(parameters)),I("startStopBtn").className="running",w.onmessage=function(e){var t=e.data.split(";"),s=Number(t[0]);s>=4&&(I("startStopBtn").className="",w=null),I("down_speed").textContent=1==s&&0==t[1]?"0.00":t[1],I("upload_speed").textContent=3==s&&0==t[2]?"0.00":t[2],I("ping_score").textContent=0==t[3]?"0":t[3],I("jitter_score").textContent=t[5],0!=t[11]&&(I("ping_final").textContent=t[11]),0!=t[9]&&(I("download_final").textContent=t[9]),0!=t[10]&&(I("upload_final").textContent=t[10]),$("#ping_progress").animate({width:100*t[8]+"%"},100),$("#down_progress").animate({width:100*t[6]+"%"},190),$("#upload_progress").animate({width:100*t[7]+"%"},190),1==t[8]&&0==t[6]&&($("#view_ping").fadeTo(250,0),$("#view_ping").hide(),document.getElementById("view_download").style.display="block",$("#view_download").fadeTo(250,1)),1==t[8]&&1==t[6]&&($("#view_download").fadeTo(250,0),document.getElementById("view_download").style.display="none",document.getElementById("view_upload").style.display="block",$("#view_upload").fadeTo(250,1)),1==t[8]&&1==t[6]&&1==t[7]&&($("#view_upload").fadeTo(250,0),document.getElementById("view_upload").style.display="none",document.getElementById("view_result").style.display="block",$("#view_result").fadeTo(250,1)),4==s&&finshed_result(I("ping_score").textContent,I("down_speed").textContent,I("upload_speed").textContent,t[12])})}function initUI(){$("#ping_score").html("0"),$("#jitter_score").html("0"),$("#down_speed").html("0.00"),$("#ping_score").html("0.00")}function restartTest(){document.getElementById("view_ping").style.visibility="visible",$("#view_result").fadeTo(250,0),document.getElementById("view_result").style.display="none",$("#view_ping").fadeTo(250,1),$("#change_server").fadeTo(250,0),$("#change_server").hide(),$("#ping_score").html("0"),$("#jitter_score").html("0"),$("#down_speed").html("0.00"),$("#ping_score").html("0.00"),$("#ping_final").html("0"),$("#download_final").html("0.00"),$("#upload_final").html("0.00"),document.getElementById("ping_progress").style.width="0",document.getElementById("down_progress").style.width="0",document.getElementById("upload_progress").style.width="0",setTimeout(function(){startStop()},1500)}function finshed_result(e,t,s,r){var n="https://speedsmart.net/resources/saveResult.php?";n+=["download="+t,"upload="+s,"ping="+e,"server="+document.getElementById("server_name").innerHTML,"localTime="+moment().format("MMM DD YYYY-h:mm a"),"version=W2.0","key="+getJSessionId(),"data="+parseFloat(r/1e3/1e3).toFixed(2)].join("&"),$.getJSON(n,function(r){var n="mailto:?subject=My SpeedSmart Result&body=Check out my Speed Test result from Speedsmart.net \n\nDownload: "+t+" Mbps\n\n Upload: "+s+" Mbps\n\n Ping: "+e+" ms Whats yours?",a="https://twitter.com/intent/tweet?text=My Speed test Result - Download "+t+" Mbps - Upload "+s+" Mbps - Ping "+e+" Ms. Whats yours? #SpeedSmart",o="https://www.facebook.com/dialog/feed?app_id=1013444825358725&link=https://speedsmart.net/result/"+r.result_id+"&picture=https://result.veeapps.com/small/"+r.result_id+"&description=My Download: result_download Mbps, Upload: result_upload Mbps, Ping: result_ping ms. How does your speed compare?&redirect_uri=https://speedsmart.net/result/"+r.result_id+"&name=How fast is your internet? Here is my SpeedSmart speed test result.",i="https://www.pinterest.com/pin/create/button/?url=https://speedsmart.net/result/"+r.result_id+"&media=https://result.veeapps.com/web/"+r.result_id+"&description=Check out my speed test result from Speedsmart.net";document.getElementById("share_email").setAttribute("href",n),document.getElementById("share_twitter").setAttribute("href",a),document.getElementById("share_facebook").setAttribute("href",o),document.getElementById("share_pintrest").setAttribute("href",i)}),$("#change_server").show(),$("#change_server").fadeTo(250,1)}setInterval(function(){w&&w.postMessage("status")},200),initUI();